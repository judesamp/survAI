#!/usr/bin/env bash
set -e

# Helper script for common Docker development tasks

case "$1" in
  "console" | "c")
    echo "ğŸ“Ÿ Starting Rails console..."
    docker-compose run --rm web rails console
    ;;

  "bash" | "shell")
    echo "ğŸš Starting bash shell..."
    docker-compose run --rm web bash
    ;;

  "migrate")
    echo "ğŸ—„ï¸ Running database migrations..."
    docker-compose run --rm web rails db:migrate
    ;;

  "rollback")
    echo "âª Rolling back migration..."
    docker-compose run --rm web rails db:rollback
    ;;

  "seed")
    echo "ğŸŒ± Seeding database..."
    docker-compose run --rm web rails db:seed
    ;;

  "reset")
    echo "ğŸ”„ Resetting database..."
    docker-compose run --rm web rails db:drop db:create db:migrate db:seed
    ;;

  "test")
    echo "ğŸ§ª Running tests..."
    docker-compose run --rm -e RAILS_ENV=test web rails test "${@:2}"
    ;;

  "routes")
    echo "ğŸ—ºï¸ Showing routes..."
    docker-compose run --rm web rails routes "${@:2}"
    ;;

  "bundle")
    echo "ğŸ“¦ Running bundle command..."
    docker-compose run --rm web bundle "${@:2}"
    ;;

  "generate" | "g")
    echo "âš™ï¸ Running Rails generator..."
    docker-compose run --rm web rails generate "${@:2}"
    ;;

  "destroy" | "d")
    echo "ğŸ—‘ï¸ Running Rails destroy..."
    docker-compose run --rm web rails destroy "${@:2}"
    ;;

  "logs")
    echo "ğŸ“œ Showing logs..."
    docker-compose logs -f "${@:2}"
    ;;

  "restart")
    echo "ğŸ”„ Restarting services..."
    docker-compose restart "${@:2}"
    ;;

  "stop")
    echo "â¹ï¸ Stopping services..."
    docker-compose stop
    ;;

  "down")
    echo "â¹ï¸ Stopping and removing containers..."
    docker-compose down
    ;;

  "ps")
    echo "ğŸ“Š Showing container status..."
    docker-compose ps
    ;;

  *)
    echo "servAI Docker Development Helper"
    echo ""
    echo "Usage: bin/docker-dev [command] [options]"
    echo ""
    echo "Commands:"
    echo "  console, c      - Start Rails console"
    echo "  bash, shell     - Start bash shell in web container"
    echo "  migrate         - Run database migrations"
    echo "  rollback        - Rollback last migration"
    echo "  seed            - Seed the database"
    echo "  reset           - Reset database (drop, create, migrate, seed)"
    echo "  test            - Run tests"
    echo "  routes          - Show routes"
    echo "  bundle          - Run bundle commands"
    echo "  generate, g     - Run Rails generators"
    echo "  destroy, d      - Run Rails destroy"
    echo "  logs            - Show container logs (use: logs [service])"
    echo "  restart         - Restart services"
    echo "  stop            - Stop all services"
    echo "  down            - Stop and remove containers"
    echo "  ps              - Show container status"
    echo ""
    echo "Examples:"
    echo "  bin/docker-dev console"
    echo "  bin/docker-dev test"
    echo "  bin/docker-dev generate model User name:string"
    echo "  bin/docker-dev logs web"
    ;;
esac