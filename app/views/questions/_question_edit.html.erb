<div class="bg-white shadow sm:rounded-lg mb-6" id="question_edit">
  <div class="px-4 py-5 sm:p-6">
    <h3 class="text-lg font-medium text-gray-900 mb-4">Edit Question</h3>

    <% if question.errors.any? %>
      <div class="mb-4 p-4 bg-red-100 border border-red-300 rounded">
        <h4 class="font-bold text-red-700 mb-2">There were errors updating this question:</h4>
        <ul class="list-disc pl-5 text-red-600">
          <% question.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form_with(model: [survey, question], local: false, method: :patch, class: "space-y-4") do |form| %>
      <div>
        <%= form.label :question_text, "Question", class: "block text-sm font-medium text-gray-700" %>
        <%= form.text_field :question_text, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm", placeholder: "What is your question?" %>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= form.label :question_type, "Question Type", class: "block text-sm font-medium text-gray-700" %>
          <%= form.select :question_type,
              options_for_select([
                ["Open Ended Text", "text"],
                ["Sliding Scale (1-10)", "scale"],
                ["Single Answer", "pick_one"],
                ["Multiple Choice", "pick_any"]
              ], question.question_type),
              {},
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",
              "data-question-type-select": true,
              onchange: "this.form.querySelectorAll('[data-pick-options]').forEach(el => el.style.display = ['pick_one','pick_any'].includes(this.value) ? 'block' : 'none')" %>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700">Required?</label>
          <div class="mt-2">
            <%= form.check_box :required, class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" %>
            <%= form.label :required, "This question is required", class: "ml-2 text-sm text-gray-600" %>
          </div>
        </div>
      </div>

      <div data-pick-options style="display: <%= ['pick_one','pick_any'].include?(question.question_type) ? 'block' : 'none' %>;">
        <%= form.label :options_text, "Options (one per line)", class: "block text-sm font-medium text-gray-700" %>
        <%= form.text_area :options_text, value: (question.options || []).join("\n"), rows: 3, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm", placeholder: "Option 1\nOption 2\nOption 3" %>
      </div>

      <div class="flex justify-end">
        <%= form.submit "Update Question", class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
      </div>
    <% end %>
  </div>
</div>
